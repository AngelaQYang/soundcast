<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FileStructure - soundcast-user-guide</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "FileStructure";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> soundcast-user-guide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">FileStructure</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#soundcast-file-and-directory-structure">SoundCast File and Directory Structure</a></li>
                
                    <li><a class="toctree-l4" href="#inputs">Inputs</a></li>
                
                    <li><a class="toctree-l4" href="#running-the-model">Running the Model</a></li>
                
                    <li><a class="toctree-l4" href="#log-files">Log Files</a></li>
                
                    <li><a class="toctree-l4" href="#model-structure">Model Structure</a></li>
                
                    <li><a class="toctree-l4" href="#results-and-outputs">Results and Outputs</a></li>
                
                    <li><a class="toctree-l4" href="#resources">Resources</a></li>
                
            
            </ul>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">soundcast-user-guide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>FileStructure</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>file-structure</p>
<h1 id="soundcast-file-and-directory-structure">SoundCast File and Directory Structure</h1>
<h2 id="inputs">Inputs</h2>
<p>Soundcast inputs will be provided as a zipped folder to users. However, at this time, inputs will only be available to users with authorized access to use Washington State's highly employment disaggregate data. PSRC is still working through solutions to provide model access to all users without access to this sensitive data. </p>
<p>For users that are able to receive the input, the folder should be unzipped and stored on a local drive. The path must be specified in "input_configuration.py" and folder structure should not be changed. Soundcast copies all inputs into the local Soundcast directory to keep paths consistent, and allows for a central storage point of different model inputs. Input folders will typically be named to represent the land use and network year, e.g., 2010 or 2040. </p>
<p>The inputs directory should be structured as follows:</p>
<pre><code>- 4k    # inputs for truck model, based on estimates from trip-based 4k model
    - auto.h5
    - transit.h5
- etc
    - daysim_outputs_seed_trips.h5    # seed trips to use on first iteration of DaySim
    - survey.h5    # 2006 household travel survey for DaySim estimation validation summaries
- landuse
    - buffered_parcels.dat
    - daily_parking_costs.csv
    - hh_and_persons.h5
    - hourly_parking_costs.csv
    - parcels_military.csv    # Military employment data
    - parcels_urbansim.txt    # Primary land-use data at the parcel level
    - schema.ini
    - tazdata.in
- networks
    - am_roadway.in
    - am_transit.in
    - am_turns.in
    ... (roadway, transit, and turns network files for 5 times of day: am, md, pm, ev, ni)
    - vehicles.txt    # list of transit vehicles and characteristics
    - modes.txt    # list of modes and their characteristics
    - fixes
        - ferries
            - am_roadway.in
            ... (roadway ferry flags for 5 times of day: am, md, pm, ev, ni)
    - rdly
        - am_rdly.txt
        ... (rdly.txt for 5 times of day: am, md, pm, ev, ni)
    - various shapefiles for showing smooth network shapes, rather than blocky network topology. Edges 0-4 correspond to 5 times of day, in order: am, md, pm, ev, ni
- supplemental
    - generation
    - distribution
    - trips
- tolls
    - am_roadway_tolls.in
    - bridge_ferry_flags.in
    - ev_roadway_tolls.in
    - ferry_vehicle_fares.in
    - md_roadway_tolls.in
    - ni_roadway_tolls.in
    - pm_roadway_tolls.in
- trucks
    - agshar.in
    - const.in
    - districts19_ga.ens
    - equipshar.in
    - heavy_trucks_reeb_ee.in
    - heavy_trucks_reeb_ei.in
    - heavy_trucks_reeb_ie.in
    - input_skims.txt
    - matrix_balancing_spec.txt
    - matric_calc_spec.txt
    - minshar.in
    - prodshar.in
    - special_gen_heavy_trucks.in
    - special_gen_light_trucks.in
    - special_gen_medium_trucks.in
    - tazdata.in
    - tcushar.in
    - truck_gen_calc_dict.txt
    - truck_matrices_dict.txt
    - truck_operating_costs.in
    - whlsshar.in
</code></pre>
<h2 id="running-the-model">Running the Model</h2>
<p>Once the inputs have been properly structured and configuration defined, Soundcast can be started with a single command-line prompt. Open a command prompt and navigate to the location the soundcast directory. In the main directory, type:</p>
<pre><code>- python run_soundcast.py
</code></pre>
<p>This will call the run_soundcast script in Python, which is the master script file to start the model. Depending on the modules specified to run in input_configuration, Soundcast will be spawn its different processes. For a new run, this includes copying inputs into the local Soundcast directory, creating new directories to store outputs, initializing Emme projects, and finally starting an iteration of DaySim demand models and assignment. The model should run until convergence, or until maximum numbers of global iterations are attained, and (if specified) produce summary files and end. </p>
<h2 id="log-files">Log Files</h2>
<p>The Soundcast run can be monitored in the command prompt, since many functions include print statements, but since it takes many hours to complete a run, all important status outputs are stored in log files in the main Soundcast directory. The two primary log files are:</p>
<pre><code>- soundcast_log.txt
- skims_log.txt
</code></pre>
<p>The soundcast log contains high-level informatino about when different modules of the run began and were completed. Here's an example from the first 2 iterations of a soundcast log:</p>
<pre><code>06/02/2015 11:25:39 AM ------------------------NEW RUN STARTING---------------------------------------
06/02/2015 11:26:11 AM  build_seed_skims starting
06/02/2015 07:39:14 PM build_seed_skims took 8:13:03.651000
06/02/2015 07:39:15 PM We're on iteration 0


06/02/2015 07:39:15 PM starting run 2015-06-02 19:39:15.084000
06/02/2015 07:39:15 PM  modify_config starting
06/02/2015 07:39:15 PM modify_config took 0:00:00
06/02/2015 07:39:15 PM  daysim_assignment starting
06/02/2015 07:39:15 PM Start of 0 iteration of Daysim
06/02/2015 08:28:47 PM End of 0 iteration of Daysim
06/02/2015 08:47:46 PM Start of 0 iteration of Skims and Paths
06/03/2015 09:03:20 AM End of 0 iteration of Skims and Paths
06/03/2015 09:03:20 AM daysim_assignment took 13:24:05.685000
06/03/2015 09:03:20 AM  check_convergence starting
06/03/2015 09:03:20 AM check_convergence took 0:00:00
06/03/2015 09:03:20 AM We're on iteration 1


06/03/2015 09:03:20 AM starting run 2015-06-03 09:03:20.784000
06/03/2015 09:03:20 AM  modify_config starting
06/03/2015 09:03:20 AM modify_config took 0:00:00
06/03/2015 09:03:20 AM  daysim_assignment starting
06/03/2015 09:03:20 AM Start of 1 iteration of Daysim
06/03/2015 10:33:40 AM End of 1 iteration of Daysim
06/03/2015 10:40:47 AM Start of 1 iteration of Skims and Paths
06/03/2015 02:09:30 PM End of 1 iteration of Skims and Paths
06/03/2015 02:09:30 PM daysim_assignment took 5:06:09.604000
06/03/2015 02:09:30 PM  check_convergence starting
06/03/2015 02:09:30 PM check_convergence took 0:00:00.015000
06/03/2015 02:09:30 PM We're on iteration 2
</code></pre>
<p>The skims log provides details on when each assignment and skimming script began, how long it took to complete, and the resulting relative gap, for each user class and time of day.</p>
<h2 id="model-structure">Model Structure</h2>
<p>Soundcast is designed to run its processes in a specific order. Understanding this flow is critical to performing partial runs (e.g., traffic assignment or demand only) that will save processing time. Being able to recover from a crash mid-way through a model run requires knowledge of how the model's scripts are designed. The basic process is as follows.</p>
<h3 id="run_soundcastpy">run_soundcast.py</h3>
<p>Soundcast's primary controller script is run_soundcast.py. Most of the major model functions are controlled here, along with input_configuration.py, which controls which processes are run, and certain input values. The run_soundcast script is rather readable, with many processes self-documented by relevant function or variable names. As with all Python scripts in Soundcast, the main function of the scripts are contained in the main() function. This is the part of the script that is first executed. In run_soundcast, subprocesses are called in a specific order. Subprocesses are controlled by binary variables that are defined in input_configuration. If these control variables are defined as True in input_configuration, Soundcast will execute that subprocess. For instance, if the variable "run_copy_daysim_code" is defined as True in the configuration, then Soundcast will run the function to move all Daysim inputs into the local directory. Many times, if a model run is being run for another iteration, or has been stopped during a crash, these processes will not need to be repeated, so they are frequently turned off (set to False). The order of subprocesses exectued by run_soundcast are as follows:</p>
<pre><code>- parcel buffering (land use preparation for demand estimation)
- parcel buffering summary (a CSV for error checking)
- copy Daysim code
- setup emmebank and project folders (for each time of day used in assignment)
- copy large inputs to local directory
- update household income to base year (2010) values
- import networks
- run all skims and paths (using seed trips for 0th iteration)
- demand modeling with Daysim
- assign truck and supplemental (external, special generator) trips
- run skims and paths using Daysim demand results
- repeat global demand and assignment for fixed number of iterations
</code></pre>
<p>The number of global iterations is defined in input_configuration.py, as the length of the pop_sample array. Each value in this list represents an iteration of demand+skimming/assignment. The number corresponds to the population size being sampled on that run. Samples are used to reduce run time, and the sample size should gradually increase with each iteration. The number is actually the denominator of the population size. For instance pop_sample = [10,5,2] indicates that 3 global iterations will be performed. The first will use a population sample size of 1/10th the actual population, the next a sample of 1/5, and finally a sample of 1/2. </p>
<h2 id="results-and-outputs">Results and Outputs</h2>
<p>As the model runs, results are stored in the 'outputs' directory of the local soundcast folder. Emme-related outputs are stored in 'projects' and 'banks' folders. Users can view results by time of day by opening up the corresponding project and bank in Emme. These files contain all time and cost skims by vehicle class and time of day. They are also available in a compressed format (hdf5) and, somewhat confusingly, created in the 'inputs' folder after an assignment iteration. They're stored in inputs because they're used as inputs to DaySim demand modeling, though they will represent the last assignment and skimming pass. These output files are named by their time period (e.g., 5to6.h5) and can be viewed interactively with Python or the <a href="https://sites.google.com/site/openmodeldata/file-cabinet/omx-viewer">OMX Viewer</a> GUI.</p>
<p>Results of DaySim demand are stored in hdf5 format as well, in the 'daysim_outputs.h5' file stored in the 'outputs' folder. These outputs include details for all persons, households, trips, and tours taken in the region, for a typical travel day. These include all the details about demographics and trip characteristics like mode, purpose, time, origin and destination, and many others. </p>
<p>Soundcast includes Python scripts to summarize model results and create output spreadsheets. The primary summaries are available in the following sheets:</p>
<pre><code>- network_summary.xlsx
- Topsheet.xlsx
</code></pre>
<p>Other summaries are included for detailed DaySim and network summaries as needed. Users may also create their own summaries by directly evaluating the h5 output files.</p>
<p>[[File Information and Directory Structure]]</p>
<h2 id="resources">Resources</h2>
<ul>
<li><a href="http://www.psrc.org/data/models/abmodel/">Activity-Based Modeling at PSRC</a></li>
<li><a href="">Soundcast Technical Design Document</a></li>
<li><a href="https://github.com/psrc/soundcast">Soundcast GitHub Repo</a></li>
<li><a href="http://onlinepubs.trb.org/onlinepubs/shrp2/SHRP2_C46.pdf">Acitivty-Based Model Primer</a></li>
<li><a href="http://www.psrc.org/about/contact/staff-roster/">PSRC Staff</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
    </span>
</div>

</body>
</html>
